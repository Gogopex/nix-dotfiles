// Zellij configuration with zjstatus notifications
simplified_ui true
default_shell "fish"
theme "gruvbox-dark"
copy_command "pbcopy"
copy_on_select true

// Session management
session_serialization true
pane_viewport_serialization true
scrollback_lines_to_serialize 10000
serialization_interval 60

// Plugins
plugins {
    zjstatus location="zellij:zjstatus" {
        // Format for notifications and status
        format_left  "#[fg=#689d6a,bold]#[bg=#3c3836] {mode}#[bg=#689d6a,fg=#1d2021,bold] {session} "
        format_center "#[fg=#ddc7a1,bg=#3c3836]{tabs}"
        format_right "#[fg=#ddc7a1,bg=#3c3836] {notifications}#[fg=#689d6a,bg=#3c3836] {datetime}"
        format_space "#[bg=#1d2021]"
        format_hide_on_overlength true
        format_precedence "crl"

        // Notification settings for Claude Code sessions and commands
        notification_format_unread           "#[fg=#d79921,bold]●"
        notification_format_no_notifications "#[fg=#504945]○"
        
        // Tab formatting with bell alerts
        tab_normal               "#[fg=#6C7086] {name} "
        tab_normal_fullscreen    "#[fg=#6C7086] {name}[] "
        tab_normal_sync          "#[fg=#6C7086] {name}<> "
        tab_active               "#[fg=#9ECE6A,bold] {name} "
        tab_active_fullscreen    "#[fg=#9ECE6A,bold] {name}[] "
        tab_active_sync          "#[fg=#9ECE6A,bold] {name}<> "
        
        // Bell alerts for background activity (including Claude Code waiting)
        tab_bell                 "#[fg=#F7768E,bold]!{name} "
        tab_bell_fullscreen      "#[fg=#F7768E,bold]!{name}[] "
        tab_bell_sync            "#[fg=#F7768E,bold]!{name}<> "

        // Mode indicators
        mode_normal        "#[fg=#689d6a,bold] NORMAL"
        mode_locked        "#[fg=#d79921,bold] LOCKED"
        mode_resize        "#[fg=#d3869b,bold] RESIZE"
        mode_pane          "#[fg=#458588,bold] PANE"
        mode_tab           "#[fg=#b16286,bold] TAB"
        mode_scroll        "#[fg=#689d6a,bold] SCROLL"
        mode_enter_search  "#[fg=#d79921,bold] SEARCH"
        mode_search        "#[fg=#d79921,bold] SEARCH"
        mode_rename_tab    "#[fg=#b16286,bold] RENAME"
        mode_rename_pane   "#[fg=#458588,bold] RENAME"
        mode_session       "#[fg=#d3869b,bold] SESSION"
        mode_move          "#[fg=#d79921,bold] MOVE"
        mode_prompt        "#[fg=#689d6a,bold] PROMPT"
        mode_tmux          "#[fg=#98971a,bold] TMUX"

        // Datetime
        datetime        "#[fg=#6C7086,bold] {format} "
        datetime_format "%A, %d %b %Y %H:%M"
        datetime_timezone "America/New_York"
    }
}

// UI configuration
ui {
    pane_frames {
        hide_session_name true
    }
}

// Key bindings (keeping existing ones)
keybinds {
    normal {
        // Tab navigation (matching Ghostty keybinds)
        bind "Cmd h" { GoToPreviousTab; }
        bind "Cmd l" { GoToNextTab; }
        bind "Cmd t" { NewTab; }
        bind "Cmd w" { CloseTab; }
        
        // Pane navigation (matching Ghostty keybinds) 
        bind "Ctrl h" { MoveFocus "Left"; }
        bind "Ctrl j" { MoveFocus "Down"; }
        bind "Ctrl k" { MoveFocus "Up"; }
        bind "Ctrl l" { MoveFocus "Right"; }
        
        // Pane resizing
        bind "Cmd Ctrl h" { Resize "Increase Left"; }
        bind "Cmd Ctrl j" { Resize "Increase Down"; }
        bind "Cmd Ctrl k" { Resize "Increase Up"; }
        bind "Cmd Ctrl l" { Resize "Increase Right"; }
        
        // Pane management
        bind "Cmd d" { NewPane "Right"; }
        bind "Cmd Shift d" { NewPane "Down"; }
        bind "Cmd Shift w" { CloseFocus; }
        
        // Pane movement
        bind "Cmd Shift h" { MovePane "Left"; }
        bind "Cmd Shift j" { MovePane "Down"; }
        bind "Cmd Shift k" { MovePane "Up"; }
        bind "Cmd Shift l" { MovePane "Right"; }
        
        // Fullscreen and frames
        bind "Cmd f" { ToggleFocusFullscreen; }
        bind "Cmd z" { TogglePaneFrames; }
        
        // Tab movement
        bind "Cmd Ctrl Shift h" { MoveTab "Left"; }
        bind "Cmd Ctrl Shift l" { MoveTab "Right"; }
        
        // Mode switching
        bind "Ctrl a" { SwitchToMode "Tmux"; }
        bind "Cmd s" { SwitchToMode "Session"; }
        
        
        // Essential shortcuts
        bind "Ctrl q" { Quit; }
        bind "Ctrl g" { SwitchToMode "Locked"; }
        bind "Ctrl Shift e" { EditScrollback; }
    }

    locked {
        bind "Ctrl g" { SwitchToMode "Normal"; }
    }

    scroll {
        bind "h" { MoveFocus "Left"; }
        bind "j" { ScrollDown; }
        bind "k" { ScrollUp; }
        bind "l" { MoveFocus "Right"; }
        bind "Ctrl f" { PageScrollDown; }
        bind "Ctrl b" { PageScrollUp; }
        bind "d" { HalfPageScrollDown; }
        bind "u" { HalfPageScrollUp; }
        bind "e" { EditScrollback; }
        bind "q" { SwitchToMode "Normal"; }
        bind "Esc" { SwitchToMode "Normal"; }
        bind "Ctrl c" { SwitchToMode "Normal"; }
        bind "/" { SwitchToMode "EnterSearch"; }
        bind "n" { Search "down"; }
        bind "N" { Search "up"; }
    }
}

// Layouts
layout {
    default_tab_template {
        pane size=1 borderless=true {
            plugin location="zellij:zjstatus"
        }
        children
    }
    
    // Existing layouts with status bar
    dev {
        tab name="dev" {
            pane {
                command "hx"
            }
            pane split_direction="vertical" size="35%" {
                pane
                pane
            }
        }
    }
    
    monitoring {
        tab name="monitor" {
            pane split_direction="vertical" size="50%" {
                pane {
                    command "btop"
                }
                pane {
                    command "procs"
                }
            }
            pane split_direction="horizontal" {
                pane {
                    command "tail"
                    args "-f" "/var/log/system.log"
                }
                pane
            }
        }
    }
    
    research {
        tab name="research" {
            pane
            pane split_direction="vertical" size="40%" {
                pane {
                    command "hx"
                }
                pane
            }
        }
    }
}